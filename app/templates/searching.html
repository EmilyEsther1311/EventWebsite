{% extends "base.html" %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Event Search</h1>
    <form method="GET" class="d-flex">
        <select name="title" class="form-select form-select-sm w-auto" onchange="this.form.submit()">
            <option value="" selected="selected">All Types</option>
            <option value="music" {% if title=="music" %}selected{% endif %}>Music</option>
            <option value="comedy" {% if title=="comedy" %}selected{% endif %}>Comedy</option>
            <option value="theatre" {% if title=="theatre" %}selected{% endif %}>Theatre</option>
        </select>
    </form>
</div>

{% if events %}
    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                     <th>Type</th>
                     <th>Location</th>
                     <th>Date</th>
                     <th>Price (£)</th>
                     <th>Capacity</th>
                     <th>Catering Req?</th>
                     <th>Catering Type</th>
                     <th>Attachment</th>
                     <th>Actions</th>
                </tr>
            </thead>
            <tbody>
              {% for event in events %}
                 <tr>
                 <td>{{ event.title.capitalize() }}</td>
                 <td>{{ event.location }}</td>
                 <td>{{ event.event_date }} </td>
                 <td>£{{ "%.2f"|format(event.ticket_price) }} </td>
                 <td>{{ event.capacity }} </td>
                 <td>
                    {% if event.catering_ind == 'yes' %}
                        <span class="badge bg-success">Yes</span>
                    {% else %}
                        <span class="badge bg-secondary">No</span>
                    {% endif %}
                 </td>
                 <td>{{ event.catering or 'N/A' }} </td>

                 {% if event.attachment_filename %}
                     <td><a href="{{ url_for('download_file', filename=event.attachment_filename) }}" class="btn btn-sm btn-outline-primary">Download</a></td>
                 {% else %}
                     <td class="text-muted">None</td>
                 {% endif %}

                 <td>
                     <div class="btn-group" role="group">
                         <a href="{{ url_for('update_event', event_id=event.id) }}" class="btn btn-sm btn-warning">Edit</a>
                         <a href="{{ url_for('delete_event', event_id=event.id) }}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this event?');">Delete</a>
                     </div>
                 </td>
                 </tr>
              {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
  <div class="alert alert-warning" role="alert">
      No events have been added yet.
  </div>
{% endif %}

<div class="mt-3">
    <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Home</a>
</div>
{% endblock %}